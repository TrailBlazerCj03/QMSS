---
title: 'HW2: Use the Tidyverse to Reshape Data'
author: "Jiacheng Zhou"
date: "2019/6/5"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Q1: Which NBA player scored the most points in 1991?
### A: Michael Jordan
```{r Q1}
library(tidyverse)
library(dplyr)
root<-rprojroot::find_rstudio_root_file()
dataDir<-file.path(root,'Data')
nba_stat <- readr::read_csv(file.path(dataDir, "Seasons_Stats_NBA.csv"))

tibble_1 <- nba_stat %>% filter(Year==1991) %>%
    select(Year, Player, PTS)
summary(tibble_1$PTS) #Find out the max points
tibble_2 <-tibble_1 %>% filter(PTS==2580)
tibble_2$Player  #Michael Jordan
```

### Q2: Which player had the best free throw percentage from the year 2000 to the most recent year in the data?   If there are multiple players who have tied for the best percentage, then sort on the column with player names and select the top name in ascending order.
### A: Aaron Miles

```{r Q2}
tibble_3 <-nba_stat %>% filter(Year>=2000) %>%
    select(Year,Player,"FT%")
summary(tibble_3$`FT%`) #Find out the max FT%.
tibble_4 <-tibble_3 %>% filter(`FT%`==1) 
tibble_5 <-tibble(Name=tibble_4$Player %>% sort(decreasing=FALSE)) #Aaron Miles
head(tibble_5,10)

```

### Q3: Rename the variable "pos" to "position"
```{r Q3}
tibble_6 <- rename(nba_stat, position=Pos)
head(tibble_6,10)

```

### Q4: Use this variable to create two variables that are called "first_position" and "second_position". 

``` {r Q4}
tibble_7<-separate(tibble_6, position, into=c("first_position","second_position" ))
head(tibble_7,10)
```

### Q5: Unite these two variables back into a single variable called "position_united"
``` {r Q5}
tibble_8<-unite(tibble_7, position_united, first_position,second_position,sep="-")
head(tibble_8,10)
```

### Q6: Create two new datasets.  1) a new dataset from the original dataset that includes all data except the age variable (be sure to give this dataset a new name).  2) a new dataset from the original dataset that includes the year, the player name, and age.  3) add a new column to both datasets called "mergeid" that includes a sequence of numbers beginning with a 1 in the first row of the data and ending with the total number of rows in the last row of the data
```{r Q6}
dataset_1<-nba_stat %>%
  select(-Age)
dataset_1 <- dataset_1 %>% mutate(mergeid=seq(1,nrow(dataset_1),1))
dataset_2 <-nba_stat %>%
    select(Year, Player, Age)
dataset_2 <- dataset_2 %>% mutate(mergeid=seq(1,nrow(dataset_2),1))
head(dataset_1, 10)
head(dataset_2,10)
```


### Q7: Join the two datasets from question six together to recreate the original dataset plus the new merge id.
```{r Q7}
dataset_merge <- dataset_1 %>% left_join(dataset_2, by = c("mergeid", "Year", "Player"))
head(dataset_merge,10)
```

### Q8: Subset the original dataset to 1995.  Group the data by year and team name and then summarise the average number of points per team. (arrange from most to least points.)
```{r Q8}
tibble_9 <- nba_stat %>%
        filter(Year == 1995)%>%
        group_by(Year,Tm) %>% 
        summarise(Avg_point = mean(PTS))%>%
        arrange(desc(Avg_point))
head(tibble_9,10)

```


### Q9: Let's reshape the data in the previous question into a wide format using tidy.  Create a wide dataset that keeps year in a single column, but spreads team names to multiple individual columns with each column delineating points per team in 1995.
```{r Q9}
tibble_10 <- tibble_9 %>%
        spread("Tm", "Avg_point")
head(tibble_10,10)
```

### Q10: Now return the data to a long (tidy) format by moving teams back into a single column and points in a single column
```{r Q10}
tibble_11 <- tibble_10 %>%
    gather("Tm", "Pts",ATL:WSB) %>%
    arrange(desc(Pts))
head(tibble_11,10)
```